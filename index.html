<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secure Password Generator</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>

  <!-- CookieConsent CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/>

  <!-- Styles… (same as before) -->
  <style>
    /* … your :root + layout + glass card + toggles CSS … */
  </style>

  <!-- 1) gtag.js with default-deny -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    // Deny both by default:
    gtag('consent','default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied'
    });
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JSQVTFQ0RF"></script>
  <script>
    gtag('js', new Date());
    // We will send config/page_view once consent is granted
  </script>
</head>
<body>
  <!-- 2) CookieConsent JS -->
  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
  <script>
    window.addEventListener('load', function(){
      window.cookieconsent.initialise({
        palette: {
          popup:  { background: '#000' },
          button: { background: '#36d1dc', text: '#fff' }
        },
        theme: 'classic',
        type: 'opt-in',
        content: {
          message:  'We use cookies for analytics & ads.',
          dismiss:  'Allow cookies',
          deny:     'Decline',
          link:     'Privacy Policy',
          href:     '/privacy.html'
        },
        onInitialise:    handleConsent,
        onStatusChange:  handleConsent
      });

      function handleConsent() {
        if (this.hasConsented()) {
          // Grant storage & load analytics + ads
          gtag('consent','update',{
            'ad_storage':        'granted',
            'analytics_storage': 'granted'
          });
          // Now configure GA and send first page_view
          gtag('config','G-JSQVTFQ0RF');
          // Enable AdSense
          (adsbygoogle = window.adsbygoogle||[]).push({});
        } else {
          gtag('consent','update',{
            'ad_storage':        'denied',
            'analytics_storage': 'denied'
          });
        }
      }
    });
  </script>

  <!-- 3) AdSense verification snippet -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7485778568309611"
    crossorigin="anonymous">
  </script>

  <!-- Dark-mode toggle & nav omitted for brevity… -->

  <div class="container">
    <!-- Ad slot will render once allow cookies is clicked -->
    <ins class="adsbygoogle"
      style="display:block"
      data-ad-client="ca-pub-7485778568309611"
      data-ad-slot="7059069610"
      data-ad-format="auto"
      data-full-width-responsive="true">
    </ins>

    <!-- Your generator UI… -->
    <input id="password" readonly placeholder="Your password"/>
    <button id="generate">Generate</button>
    <button id="copy">Copy</button>
    <input type="range" id="length" min="8" max="32" value="16"/>
  </div>

  <script>
    // Track events only after gtag('config') has run:
    const genBtn  = document.getElementById('generate');
    const copyBtn = document.getElementById('copy');
    const slider  = document.getElementById('length');

    genBtn.addEventListener('click', () => {
      // … password gen logic …
      gtag('event','generate_password',{
        event_category:'engagement',
        event_label:`${slider.value} chars`
      });
    });
    copyBtn.addEventListener('click', () => {
      // … copy logic …
      gtag('event','copy_password',{ event_category:'engagement' });
    });
  </script>
</body>
</html>
